PACKAGES = uni-mmiss uni-davinci

SRCS       = TestStructure.hs TestLaTeXStructure.hs MainMMiSSWorkbench.hs

EXTRAEXPORTS = MMiSSWorkbench files/test_1.tex files/test_2.tex files/demo-terms.tex files/demo.tex files/algspec.tex

include @TOP@/mk/boilerplate.mk

prepareexports : MMiSSWorkbench

.PHONY : runServer runWorkbench killServer killWorkbench

WORKINGDIR = $${UNIWORKINGDIR:-/tmp/@}
DBDIR = $(WORKINGDIR)/simpledb
STOREDIR = $(WORKINGDIR)/storeDir
BACKUPDIR = $(WORKINGDIR)/backup

runServer :
	@MKDIR@ -p $(DBDIR)
	@MKDIR@ -p $(BACKUPDIR)
	@BDBDIR@/bin/berkeley_db_svc -h $(DBDIR) &
	LD_LIBRARY_PATH=@BDBDIR@/lib:$$LD_LIBRARY_PATH ../../types/test/Server --uni-debug=s.debug --uni-backupDir=$(BACKUPDIR) --uni-storeDir=$(STOREDIR) &

killServer :
	(pkill "^berkeley_db_svc$$" || echo not running)
	(pkill "^Server$$" || echo not running)
	rm -rf $(WORKINGDIR)

killRestartServer :
	(pkill "^berkeley_db_svc$$" || echo not running)
	(pkill "^Server$$" || echo not running)
	rm -rf $(WORKINGDIR)/tmp

runWorkbench :
	LD_LIBRARY_PATH=@BDBDIR@/lib:$$LD_LIBRARY_PATH ./MMiSSWorkbench --uni-debug=w.debug

killWorkbench :
	(pkill "^MMiSSWorkbench$$" || echo not running)
