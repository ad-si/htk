PACKAGES = uni-mmiss uni-davinci

SRCS       = TestStructure.hs TestLaTeXStructure.hs MainMMiSSWorkbench.hs

EXTRAEXPORTS = MMiSSWorkbench files/test_1.tex files/test_2.tex files/demo-terms.tex files/demo.tex files/algspec.tex Makefile.in runWorkbench.in rerunWorkbench.in runWorkbenchRemote.in testfiles isConnected

include @TOP@/mk/boilerplate.mk

prepareexports : MMiSSWorkbench isConnected

displaysrcshere : displayextrasrcs

displayextrasrcs :
	@echo @TOP@/mmiss/test/rerunWorkbench.in @TOP@/mmiss/test/runWorkbench.in
	@echo @TOP@/mmiss/test/restartWorkbench.in @TOP@/mmiss/test/testfiles

.PHONY : runServer runWorkbench killServer killWorkbench displayextrasrcs

WORKINGDIR = $${UNIWORKINGDIR:-/tmp/@}
DBDIR = $(WORKINGDIR)/simpledb
BACKUPDIR = $(WORKINGDIR)/backup
UNITEMPFILES = $(WORKINGDIR)/\#

runServer :
	UNIDEBUG=$$PWD/s.debug $(MAKE) -r -C $(TOP)/types/test runServer

killServer :
	$(MAKE) -r -C $(TOP)/types/test killServer

killRestartServer :
	(pkill "^berkeley_db_svc$$" || echo not running)
	(pkill "^Server$$" || echo not running)
	rm -rf $(WORKINGDIR)/tmp

runWorkbench :
	LD_LIBRARY_PATH=@BDBDIR@/lib:$$LD_LIBRARY_PATH ./MMiSSWorkbench --uni-debug=w.debug

killWorkbench :
	(pkill "^MMiSSWorkbench$$" || echo not running)
	rm -rf $(UNITEMPFILES)

packages : isConnected

isConnected : IsConnected.hs
	$(HC) IsConnected.hs -o isConnected -package net