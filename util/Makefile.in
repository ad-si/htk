PACKAGE = uni-util

ifeq "$(sort 603A @GhcShortVersion@B)" "603A @GhcShortVersion@B"
# We are using ghc6.3 or later, which requires the template-haskell
# package to be specified.  The A and B prevent $(sort) from removing
# the duplicate element when we are using 6.3.
TEMPLATEHASKELLPACKAGE = template-haskell
else
TEMPLATEHASKELLPACKAGE = haskell-src
endif

PACKAGES = concurrent lang data network text uni-options $(TEMPLATEHASKELLPACKAGE)

SRCS       = \
  TemplateHaskellHelps.hs CompileFlags.hs \
  Queue.hs ExtendedPrelude.hs Computation.hs Dynamics.hs \
  WBFiles.hs Object.hs Debug.hs Maybes.hs LineShow.hs Cache.hs FileNames.hs \
  IOExtras.hs QuickReadShow.hs AtomString.hs SmallSet.hs Registry.hs \
  RegularExpression.hs DelSet.hs Thread.hs UniqueString.hs UniqueFile.hs \
  TempFile.hs Sink.hs VariableSet.hs VariableMap.hs \
  CommandStringSub.hs WaitOnN.hs FileSystem.hs PtrMagic.hs CacheTable.hs \
  DeepSeq.hs NameMangle.hs KeyedChanges.hs \
  Sources.hs Broadcaster.hs ReferenceCount.hs Delayer.hs VariableList.hs \
  Myers.hs VariableSetBlocker.hs IntPlus.hs UnionFind.hs \
  ICStringLen.hs VisitedSet.hs StrError.hs HostName.hs \
  Bytes.hs Binary.hs BinaryUtils.hs BinaryInstances.hs BinaryExtras.hs \
  BinaryAll.hs StringSkip.hs ThreadDict.hs TSem.hs Store.hs Messages.hs \
  ClockTimeToString.hs UTF8.hs VSem.hs \

SRCSC      = new_object.c default_options.c copy_file.c

SUBDIRS = test

DOCPP=YES

include @TOP@/mk/boilerplate.mk

# We include special handling for defaultoptions when exporting.
prepareexportshere : changedefaultoptions

displaysrcshere : displayextrasrcs

displayextrasrcs :
	@echo @TOP@/util/default_options.default.c

.PHONY : changedefaultoptions displayextrasrcs

changedefaultoptions : 
	$(CCH) $(CFLAGS) -c default_options.default.c -o default_options.o
	$(AR) -r $(LIB) default_options.o  
	$(MAKE) packageherequick